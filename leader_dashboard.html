<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leader Dashboard</title>
    <!-- Bootstrap CSS Link -->
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div id="alertContainerDashboard" class="container mt-4"></div>
    <div class="container mt-5">
      <div class="row">
        <div class="col-6">
          <h1>Leader Dashboard</h1>
        </div>
        <div class="col-6" style="text-align: right">
          <button class="btn btn-danger" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- Annotator Info -->
      <div class="card">
        <div class="card-header">Annotator Information</div>
        <div class="card-body">
          <p><strong>Email:</strong> <span id="email">Loading ...</span></p>
          <p><strong>Name:</strong> <span id="name">Loading ...</span></p>
          <p>
            <strong>Date of Joining:</strong>
            <span id="joiningDate">Loading ...</span>
          </p>
          <p>
            <strong>Designation:</strong>
            <span id="designation">Loading ...</span>
          </p>
          <p><strong>Language:</strong> <span id="language">XXXX</span></p>
          <p><strong>Role:</strong> <span id="role">Loading ...</span></p>
        </div>
      </div>

      <!-- Annotations List -->
      <div class="mt-4 row">
        <div class="col-4">
          <!-- Dropdown wrapper -->
          <div class="dropdown">
            <!-- Trigger button for dropdown -->
            <button
              class="btn btn-primary dropdown-toggle w-100"
              type="button"
              id="languageDropdownFilter"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              Language View
            </button>

            <!-- Dropdown Menu -->
            <div
              class="dropdown-menu w-100"
              aria-labelledby="languageDropdownFilter"
            >
              <a class="dropdown-item" href="#">Python</a>
              <a class="dropdown-item" href="#">Java</a>
              <a class="dropdown-item" href="#">JavaScript</a>
            </div>
          </div>
        </div>

        <div class="col-4">
          <!-- Dropdown wrapper -->
          <div class="dropdown">
            <!-- Trigger button for dropdown -->
            <button
              class="btn btn-primary dropdown-toggle w-100"
              type="button"
              id="podDropdownFilter"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              POD View
            </button>

            <!-- Dropdown Menu -->
            <div
              class="dropdown-menu w-100"
              aria-labelledby="podDropdownFilter"
            >
              <a class="dropdown-item" href="#">POD 1</a>
              <a class="dropdown-item" href="#">POD 2</a>
              <a class="dropdown-item" href="#">POD 3</a>
              <a class="dropdown-item" href="#">POD 4</a>
              <a class="dropdown-item" href="#">POD 5</a>
              <a class="dropdown-item" href="#">POD 6</a>
              <a class="dropdown-item" href="#">POD 7</a>
              <a class="dropdown-item" href="#">POD 8</a>
            </div>
          </div>
        </div>

        <div class="col-4">
          <button
            class="btn btn-primary w-100"
            type="button"
            id="annotatorViewBtn"
          >
            Annotator View
          </button>
        </div>
      </div>
      <div class="card mt-4 mb-4">
        <div class="card-header">
          <div class="row">
            <div class="col-6">Annotator Name</div>
            <div class="col-6">Annotations in Past 1 hour</div>
          </div>
        </div>
        <div
          class="list-group list-group-flush"
          style="padding: 10px"
          id="annotationList"
        ></div>
      </div>
    </div>

    <!-- Bootstrap & jQuery JS Links -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>

    <!-- Custom JS -->
    <script src="script.js"></script>

    <script>
      let annotatorDetails = {};
      if (
        localStorage.getItem("loggedIn") === undefined ||
        localStorage.getItem("annotatorEmail") === undefined ||
        localStorage.getItem("loggedIn") === null ||
        localStorage.getItem("annotatorEmail") === null
      ) {
        location.href = "/index.html";
      }

      function searchByFilter() {
        console.log("Implement search functionality");
      }

      function searchByFilter() {
        console.log("Reset annotation list");
      }

      $(document).ready(function () {
        showSuccessAlertDashboard("Loading details ...");

        $(".dropdown-menu a").click(function () {
          $("#filterDropdownMenuButton").text($(this).text());
        });

        // Create a new instance of XMLHttpRequest
        var xhr = new XMLHttpRequest();

        // Configure the request type, URL, and asynchronous flag
        xhr.open("POST", "http://localhost:3000/api/employee/filter", true);

        // Set the request header for content-type
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        // Define the callback for when the request has completed
        xhr.onload = function () {
          const response = JSON.parse(xhr.responseText);
          if (xhr.status >= 200 && xhr.status < 400) {
            // The request was successful! Handle the response here.
            document.getElementById("email").innerText =
              response.message[0]?.annotatorEmail;
            document.getElementById("name").innerText =
              response.message[0]?.annotatorName;
            document.getElementById("role").innerText =
              response.message[0]?.annotatorRole;
            document.getElementById("joiningDate").innerText = formatDate(
              response.message[0]?.dateOfJoining
            );
            document.getElementById("designation").innerText =
              response.message[0]?.designation;

            annotatorDetails = response.message[0];

            if (response.message[0].annotatorRole !== "tertiary") {
              window.location.href = "./dashboard.html";
            }

            // annotation request start ------------------------------
            showSuccessAlertDashboard("Loading annotations ...");

            // fill with the leader view APIs

            const annotatorData = [
              {
                annotatorName: "adimalik@deloitte.com",
                annotations: 2,
              },
              {
                annotatorName: "subhamsaha@deloitte.com",
                annotations: 1,
              },
              {
                annotatorName: "jhsharma@deloitte.com",
                annotations: 3,
              },
              {
                annotatorName: "bhaskar@deloitte.com",
                annotations: 4,
              },
            ];

            const languageData = [
              {
                language: "Python",
                annotations: 2,
              },
              {
                language: "Java",
                annotations: 1,
              },
              {
                language: "JavaScript",
                annotations: 3,
              },
            ];

            const annotationListContainer =
              document.getElementById("annotationList");

            languageData.forEach((record) => {
              const listItemContainer = document.createElement("div");
              listItemContainer.className = "row m-3";

              const listItemAnnotatorName = document.createElement("div");
              listItemAnnotatorName.className = "col-6";
              listItemAnnotatorName.innerText = record.language;

              const listItemAnnotations = document.createElement("div");
              listItemAnnotations.className = "col-6";
              listItemAnnotations.innerText = record.annotations;

              listItemContainer.appendChild(listItemAnnotatorName);
              listItemContainer.appendChild(listItemAnnotations);

              annotationListContainer.appendChild(listItemContainer);
            });

            // annotation request end --------------------------------
          } else {
            // The request failed with a status code outside the range [200, 400).
            // Handle the error here.
            console.error(
              "Request failed: " + xhr.status + " " + xhr.statusText
            );
            showFailAlertDashboard(response.message);
          }
        };

        // Define the callback for network errors
        xhr.onerror = function () {
          console.error("Network error occurred.");
          showFailAlertDashboard(xhr.message);
        };

        var data = JSON.stringify({
          field: "annotatorEmail",
          value: localStorage.getItem("annotatorEmail"),
        });
        xhr.send(data);
      });
    </script>
  </body>
</html>
